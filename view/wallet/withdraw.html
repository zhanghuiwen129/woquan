<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>提现 - {$name}</title>
    <script src="https://cdn.tailwindcss.com?hide-warning=true"></script>
    <link rel="stylesheet" href="/fontawesome/css/font-awesome.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#4A90E2',
                        secondary: '#6AA9F2',
                        lightBlue: '#E8F3FF',
                        danger: '#F04848',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen pb-20">
    <div class="container mx-auto px-4 py-6">
        <!-- 页面头部 -->
        <div class="flex items-center justify-between mb-6">
            <a href="/wallet" class="text-gray-600 hover:text-gray-800">
                <i class="fa fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-xl font-bold text-gray-800">申请提现</h1>
            <div class="w-6"></div>
        </div>

        <!-- 可提现余额 -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-4">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-gray-400 text-sm mb-1">可提现余额</div>
                    <div class="text-3xl font-bold text-gray-800">{$currency.symbol|default='¥'}{$balance|default='0.00'}</div>
                </div>
                <a href="/wallet/transactions" class="text-primary text-sm">
                    提现记录 <i class="fa fa-angle-right"></i>
                </a>
            </div>
        </div>

        <!-- 提现表单 -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-4">
            <h3 class="text-gray-800 font-semibold mb-4">提现信息</h3>
            
            <form id="withdraw-form">
                <!-- 提现金额 -->
                <div class="mb-4">
                    <label class="block text-gray-600 text-sm mb-2">提现金额</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xl">{$currency.symbol|default='¥'}</span>
                        <input type="number"
                            id="withdraw-amount"
                            name="amount"
                            class="w-full pl-10 pr-4 py-4 border border-gray-200 rounded-lg text-xl font-bold outline-none focus:border-primary"
                            placeholder="请输入提现金额"
                            min="1"
                            max="{$balance|default='0'}"
                            data-currency-id="{$currency.id|default='1'}">
                    </div>
                    <div class="flex justify-between mt-2 text-sm">
                        <span class="text-gray-400">最低提现：{$currency.symbol|default='¥'}1.00</span>
                        <button type="button" class="text-primary" onclick="setAllAmount()">全部提现</button>
                    </div>
                </div>

                <!-- 提现方式 -->
                <div class="mb-4">
                    <label class="block text-gray-600 text-sm mb-3">提现方式</label>
                    <div class="space-y-3">
                        {volist name="withdrawMethods" id="method"}
                        <label class="flex items-center justify-between p-4 border-2 {$method@first ? 'border-primary' : 'border-gray-200'} rounded-lg cursor-pointer hover:border-gray-300" data-method="{$method.id}">
                            <div class="flex items-center gap-3">
                                <input type="radio" name="method" value="{$method.id}" class="hidden" {$method@first ? 'checked' : ''}>
                                <div class="w-10 h-10 rounded-lg {$method.id == 'alipay' ? 'bg-blue-500' : ($method.id == 'wechat' ? 'bg-green-500' : 'bg-gray-500')} flex items-center justify-center text-white">
                                    <i class="fa {$method.icon} text-lg"></i>
                                </div>
                                <span class="text-gray-800 font-medium">{$method.name}</span>
                            </div>
                            <i class="fa {$method@first ? 'fa-check-circle text-primary' : 'fa-circle-o text-gray-300'}"></i>
                        </label>
                        {/volist}
                    </div>
                </div>

                <!-- 收款账号 -->
                <div class="mb-4" id="account-section">
                    <label class="block text-gray-600 text-sm mb-2">收款账号</label>
                    <input type="text" 
                        id="withdraw-account"
                        name="account"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg outline-none focus:border-primary"
                        placeholder="请输入收款账号">
                </div>

                <!-- 真实姓名 -->
                <div class="mb-6">
                    <label class="block text-gray-600 text-sm mb-2">真实姓名</label>
                    <input type="text" 
                        id="withdraw-name"
                        name="real_name"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg outline-none focus:border-primary"
                        placeholder="请输入与收款账号一致的姓名">
                </div>

                <!-- 提现按钮 -->
                <button type="submit" class="w-full bg-gradient-to-r from-primary to-secondary text-white font-semibold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all">
                    确认提现
                </button>
            </form>

            <!-- 提现说明 -->
            <div class="mt-6 bg-lightBlue rounded-lg p-4">
                <h4 class="text-primary font-medium mb-2"><i class="fa fa-info-circle mr-1"></i>提现说明</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                    <li>• 最低提现金额为1元</li>
                    <li>• 提现将在1-3个工作日内到账</li>
                    <li>• 请确保收款账号信息准确</li>
                    <li>• 如有疑问请联系客服</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-6 py-3 rounded-lg hidden z-[2000]"></div>

    <script>
        const withdrawForm = document.getElementById('withdraw-form');
        const amountInput = document.getElementById('withdraw-amount');
        const accountInput = document.getElementById('withdraw-account');
        const nameInput = document.getElementById('withdraw-name');
        const maxBalance = parseFloat('{$balance|default=\'0\'}');
        const currencyId = parseInt('{$currency.id|default=\'1\'}');

        // 提现方式选择
        document.querySelectorAll('[data-method]').forEach(method => {
            method.addEventListener('click', function() {
                document.querySelectorAll('[data-method]').forEach(m => {
                    m.classList.remove('border-primary');
                    m.classList.add('border-gray-200');
                    const icon = m.querySelector('i');
                    icon.classList.remove('fa-check-circle', 'text-primary');
                    icon.classList.add('fa-circle-o', 'text-gray-300');
                    m.querySelector('input').checked = false;
                });

                this.classList.remove('border-gray-200');
                this.classList.add('border-primary');

                const icon = this.querySelector('i');
                icon.classList.remove('fa-circle-o', 'text-gray-300');
                icon.classList.add('fa-check-circle', 'text-primary');
                this.querySelector('input').checked = true;
            });
        });

        // 全部提现
        function setAllAmount() {
            if (maxBalance > 0) {
                amountInput.value = maxBalance.toFixed(2);
            }
        }

        // 表单提交
        withdrawForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const amount = parseFloat(amountInput.value);
            const method = document.querySelector('input[name="method"]:checked').value;
            const account = accountInput.value.trim();
            const realName = nameInput.value.trim();

            // 验证
            if (!amount || amount < 1) {
                showToast('提现金额不能小于1');
                return;
            }

            if (amount > maxBalance) {
                showToast('余额不足');
                return;
            }

            if (!account) {
                showToast('请输入收款账号');
                accountInput.focus();
                return;
            }

            if (!realName) {
                showToast('请输入真实姓名');
                nameInput.focus();
                return;
            }

            // 提交提现申请
            const formData = new FormData();
            formData.append('amount', amount);
            formData.append('currency_id', currencyId);
            formData.append('method', method);
            formData.append('account', account);
            formData.append('real_name', realName);

            fetch('/wallet/createWithdraw', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.code === 200) {
                    showToast('提现申请提交成功');
                    setTimeout(() => {
                        window.location.href = '/wallet/transactions';
                    }, 1500);
                } else {
                    showToast(result.msg || '提现申请失败');
                }
            })
            .catch(error => {
                console.error('提现失败:', error);
                showToast('网络错误，请重试');
            });
        });

        // 显示提示
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 2000);
        }
    </script>
</body>
</html>
